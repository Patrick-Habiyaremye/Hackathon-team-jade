"use strict";(()=>{var e={};e.id=480,e.ids=[480],e.modules={3524:e=>{e.exports=require("@prisma/client")},6517:e=>{e.exports=require("lodash")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},1295:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>p,originalPathname:()=>q,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>c,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>f});var s={};r.r(s),r.d(s,{GET:()=>GET,POST:()=>POST});var a=r(884),n=r(6132),o=r(5798),i=r(5204),u=r(8192);async function GET(e){try{let t;let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return o.Z.json({message:"Unauthorized"},{status:401});let s=r.substring(7),a=(0,u.WX)(s);if(!a)return o.Z.json({message:"Invalid token"},{status:401});let n=await i._.user.findUnique({where:{id:a.userId}});if(!n)return o.Z.json({message:"User not found"},{status:404});if("MENTOR"===n.role)t=await i._.mentorRequest.findMany({where:{mentorId:n.id},include:{mentee:{select:{firstName:!0,lastName:!0,email:!0}}},orderBy:{createdAt:"desc"}});else{if("MENTEE"!==n.role)return o.Z.json({message:"Invalid role"},{status:400});t=await i._.mentorRequest.findMany({where:{menteeId:n.id},include:{mentor:{select:{firstName:!0,lastName:!0,email:!0}}},orderBy:{createdAt:"desc"}})}return o.Z.json(t)}catch(e){return console.error("Failed to fetch mentor requests:",e),o.Z.json({message:"Internal server error"},{status:500})}}async function POST(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return o.Z.json({message:"Unauthorized"},{status:401});let r=t.substring(7),s=(0,u.WX)(r);if(!s)return o.Z.json({message:"Invalid token"},{status:401});let{mentorId:a,message:n}=await e.json();if(!a||!n)return o.Z.json({message:"Mentor ID and message are required"},{status:400});let d=await i._.user.findUnique({where:{id:s.userId}});if(!d||"MENTEE"!==d.role)return o.Z.json({message:"Only mentees can send requests"},{status:403});let m=await i._.mentorProfile.findFirst({where:{userId:a,isApproved:!0}});if(!m)return o.Z.json({message:"Mentor not found or not approved"},{status:404});let l=await i._.mentorRequest.findFirst({where:{menteeId:d.id,mentorId:a}});if(l)return o.Z.json({message:"Request already sent to this mentor"},{status:400});let c=await i._.mentorRequest.create({data:{menteeId:d.id,mentorId:a,message:n}});return await i._.notification.create({data:{userId:a,title:"New Mentorship Request",message:`${d.firstName} ${d.lastName} has requested your mentorship.`,type:"REQUEST_SENT"}}),o.Z.json({message:"Request sent successfully",request:c})}catch(e){return console.error("Failed to create mentor request:",e),o.Z.json({message:"Internal server error"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/mentor-requests/route",pathname:"/api/mentor-requests",filename:"route",bundlePath:"app/api/mentor-requests/route"},resolvedPagePath:"C:\\Project\\Diaspora1\\Hackathon-team-jade\\app\\api\\mentor-requests\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:l,serverHooks:c,headerHooks:p,staticGenerationBailout:f}=d,q="/api/mentor-requests/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[386,390],()=>__webpack_exec__(1295));module.exports=r})();